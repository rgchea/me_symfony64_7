Some client code omitted for confidentiality