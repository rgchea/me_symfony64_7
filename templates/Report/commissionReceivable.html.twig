{% extends "base.html.twig" %}

{% block breadcrumb %}
    {{ parent() }}
    <li> <a href="{{ path('report_commission_receivable') }}">Comisión Servicio por Cobrar</a> </li>
    {% endblock %}

{% block title %}
    Comisión Servicio por Cobrar
{% endblock %}


{% block myContent %}
    {{ parent() }}
	   
	<style>
	    .input-group {
	        z-index: 0;
	    }
	</style>
	
	<div class="row">
        <article class="col-sm-12 col-md-12 col-lg-12 sortable-grid ui-sortable">
                <div data-widget-editbutton="false" data-widget-colorbutton="false" id="wid-id-2" class="jarviswidget jarviswidget-sortable" style="" role="widget">
                    <header role="heading">
                        <h2>Comisión Servicio por Cobrar</h2>

                    </header>
                    <!-- widget div-->
                    <div role="content">
                    <!-- widget edit box -->
                        <div class="jarviswidget-editbox">
                        <!-- This area used as dropdown edit box -->
                        </div>
                        <!-- end widget edit box -->
                        <!-- widget content -->
                        <div class="widget-body">
                            <form id="filterForm" action="{{path('report_commission_receivable')}}" method="POST" name="report_commission_receivable">
                                <input type="hidden" name="filter" value="true" />
                                <input type="hidden" name="toExcel" id="toExcel" value="false" />

                                <div class="form-group row" >
                                    <div class="col-md-4">
                                        <label for="select_dealer">Consecionario:</label><br />
                                        <select class="form-control" id="select_dealer" name="select_dealer"  >
                                            <option value="0">Todos</option>
                                            {% for d in dealer%}
                                                {% set selected = d.id == select_dealer ? ' selected="selected" ' : ''%}
                                                <option value="{{d.id}}" {{selected}}>{{ d.name }}</option>
                                            {% endfor %}
                                        </select>
                                        <input type="hidden" name="select_tipo" value="0"/>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="created_from">Desde:</label><br />
                                        <input id="created_from" name="created_from" type="date" class="form-control" value="{{filter_created_from}}" />

                                    </div>
                                    <div class="col-md-4">
                                        <label for="created_to">Hasta:</label><br />
                                        <input  id="created_to" name="created_to" type="date" class="form-control" value="{{filter_created_to}}" />
                                    </div>
                                </div>
                                <div class="clearfix"></div>
                                <div class="row">
                                    <div class="form-group col-md-2">
                                        <button class="btn btn-primary">
                                            <i class="fa fa-search"></i>
                                            Filtrar
                                        </button>
                                    </div>
                                    <div class="form-group col-md-8">
                                    </div>
                                    <div class="form-group col-md-2 pull-right">
                                        <button type="button" class="btn btn-success" onclick="updateCommission();">
                                            Exportar a Excel
                                        </button>
                                    </div>

                                </div>
                                <div class="clearfix"></div>

                                <br />
                                <table id="commission_table" class="table table-striped table-bordered table-hover" >
                                    {% if commissions is iterable%}
                                    <thead>
                                        <tr>
                                            <th>Concesionario</th>
                                            <th>Fecha</th>
                                            <th>Guia</th>
                                            <th>Servicio</th>
                                            <th>Peso</th>
                                            <th>Costo</th>
                                            <th>Comision</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>

                                        {#
                                        <script type="text/javascript">
                                            var arrCommissions = new Array();
                                        </script>

                                        #}

                                        {% for co in commissions %}

                                            {#
                                            <script type="text/javascript">
                                                arrCommissions.push({{ co.id }});
                                            </script>

                                            #}
                                            <tr>
                                                <input type="hidden" name="tableArray[{{ co.id }}][dealer]" id="{{ co.id }}_dealer" value="{{ co.dealer }}" />
                                                <input type="hidden" name="tableArray[{{ co.id }}][created_at]" id="{{ co.id }}_created_at" value="{{ co.created_at|date("d/m/Y") }}" />
                                                <input type="hidden" name="tableArray[{{ co.id }}][code]" id="{{ co.id }}_code" value="{{ co.code }}" />
                                                <input type="hidden" name="tableArray[{{ co.id }}][service]" id="{{ co.id }}_service" value="{{ co.service }}" />
                                                <input type="hidden" name="tableArray[{{ co.id }}][weight]" id="{{ co.id }}_weight" value="{{ co.weight }}" />
                                                <input type="hidden" name="tableArray[{{ co.id }}][price]" id="{{ co.id }}_price" value="{{ co.price }}" />
                                                <input type="hidden" name="tableArray[{{ co.id }}][commission]" id="{{ co.id }}_commission" value="{{ co.commission }}" />
                                                <input type="hidden" name="tableArray[{{ co.id }}][status]" id="{{ co.id }}_status" value="{{ co.status }}" />


                                                <td>{{ co.dealer }}</td>
                                                <td>{{ co.created_at|date("d/m/Y") }}</td>
                                                <td>{{ co.code }}</td>
                                                <td>{{ co.service }}</td>
                                                <td>{{ co.weight }}</td>
                                                <td>{{ co.price }}</td>
                                                <td id="td_guide_{{ co.id }}" >
                                                    <input id="guide_edit_{{ co.id }}" type="number" value="{{ co.commission }}" class="form-control" />
                                                </td>
                                                <td>{{ co.status }}</td>
                                            </tr>
                                        {% endfor %}

                                    </tbody>
                                    {% endif %}

                                </table>
                            </form>
                        </div>
                        <!-- end widget content -->
                    </div>
                    <!-- end widget div -->
                </div>
                <div class="clearfix"></div>
            </article>
	</div>

	<script type="text/javascript" language="Javascript">

        function updateCommission(){

            $('#pizote_spinner').show();
            $("#toExcel").val(true);

            //alert(arrCommissions.length);

            //for (myValue in arrCommissions){//myValue = guide_id
            {% for co in commissions %}
                //myGuide = arrCommissions[myValue];
                myGuide = {{ co.id }};
                tmpValue = $("#guide_edit_"+myGuide).val();
                //tmpValue = 0;
                //$("#guide_edit_"+myGuide).remove();
                //$("#td_guide_"+myGuide).html(tmpValue);
                $("#"+myGuide+"_commission").val(tmpValue);

            {% endfor %}

            //}

            $("#filterForm").submit();
            $('#pizote_spinner').hide();
            //tableToArray();
        }

        function tableToArray(){

            var convertedIntoArray = [];
            $("table#commission_table tr").each(function() {
                var rowDataArray = [];
                var actualData = $(this).find('td');
                if (actualData.length > 0) {
                    actualData.each(function() {
                        rowDataArray.push($(this).text());
                    });
                    convertedIntoArray.push(rowDataArray);
                }
            });
        }

        $(document).ready(function(){

            $('#commission_table').DataTable({
                //dom: 'Bfrtip',
                /*
                buttons: [
                    {extend: 'print', text: 'Imprimir', message: ''},
                    {extend: 'excel', text: 'Exportar Excel',message: ''}
                ],
                 */
                "aaSorting": [[ 0, "asc" ]],
                "lengthMenu": [ [10, 25, 50, 100, -1], [10, 25, 50, 100,"Todos"] ],
                "iDisplayLength": -1,

            });

        });


	</script>  
   
{% endblock %}
