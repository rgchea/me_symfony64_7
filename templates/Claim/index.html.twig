{% extends "base.html.twig" %}

{% block breadcrumb %}
    {{ parent() }}
    <li> <a href="{{ path('backend_admin_claim_index') }}">Listado de Reclamos</a> </li>
    {% endblock %}

{% block title %}
    Reclamos
{% endblock %}



{% block myContent %}

    <header>
        <h2> Listado de Reclamos</h2>
    </header>

    <!-- widget div-->
    <div>



    <form style="width: 100%" id="filterForm" action="{{path('backend_admin_claim_index')}}" method="POST" name="form_claim">
        <input type="hidden" name="filter" value="true" />
        <input type="hidden" name="toExcel" id="toExcel" value="false" />
        <div class="row" >

            <div class="col-md-4">
                <label for="filter_status">Status:</label>
                <select id="filter_status" name="filter_status" class="form-control"  >
                    <option value="Todos" {{ filter_status == 'Todos' ? 'selected' : '' }}>Todos</option>
                    <option value="Pendiente" {{ filter_status == 'Pendiente' ? 'selected' : '' }}>Pendiente</option>
                    <option value="Autorizado" {{ filter_status == 'Autorizado' ? 'selected' : '' }}>Autorizado</option>
                    <option value="No Autorizado" {{ filter_status == 'No Autorizado' ? 'selected' : '' }}>No Autorizado</option>
                </select>
            </div>


            <div class="col-md-4">
                <label for="filter_created_from">Desde:</label>
                <input  id="filter_created_from" name="filter_created_from" type="date" class="form-control input-daterange" value="{{filter_created_from}}" />

            </div>

            <div class="col-md-4">
                <label for="filter_created_to">Hasta:</label><br />
                <input  id="filter_created_to" name="filter_created_to" type="date" class="form-control input-daterange" value="{{filter_created_to}}" />

            </div>


        </div>
        <div class="row">
            <div class="clearfix"></div>

            <div class="col-md-12">
                <label for="apply_dates">Aplicar Fechas:</label><br />
                <input type="checkbox" class="" name="filter_dates" id="filter_dates" {{ filter_dates == 1 ? 'checked' : '' }}>
            </div>
        </div>
        <div class="row">


            <div class="col-md-10">
                <button class="btn btn-primary">
                    <i class="fa fa-search"></i>
                    Filtrar
                </button>
            </div>
            <div class="col-md-2 pull-right">
                <button type="button" class="btn btn-success" onclick="submitExcel();">
                    Exportar a Excel
                </button>
            </div>

        </div>

        <br />

        <table id="dt_basic" class="table table-striped table-bordered table-hover">
        <thead>
            <tr>
                <th>ID Reclamo</th>
                <th>Creado por</th>
                <th>Fecha</th>
                <th>Tipo</th>
                <th style="width: 100px">Reclamo</th>
                <th>Status Reclamo</th>
                <th>Guía</th>
                <th>Reposición</th>
                <th>Compra de Producto</th>
                <th>Monto Compra de Producto</th>
                <th>Observaciones</th>

                {% if(user.role.name == "ADMINISTRADOR") %}
                    <th width="150">Acciones</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
        {% for entity in entities %}

            {% set claimID = entity.claim.id %}
            <tr>
                <input type="hidden" name="tableArray[{{ claimID }}][id]" id="{{ claimID }}_id" value="{{ entity.claim.id }}" />
                <td>{{ entity.claim.id }}</td>

                <input type="hidden" name="tableArray[{{ claimID }}][createdBy]" id="{{ claimID }}_createdBy" value="{{ entity.claim.createdBy }}" />
                <td>{{  entity.claim.createdBy is not null ?  entity.claim.createdBy.username : "---" }}</td>

                <input type="hidden" name="tableArray[{{ claimID }}][createdAt]" id="{{ claimID }}_createdAt" value="{{ entity.claim.createdAt|date('d-m-Y') }}" />
                <td>{{ entity.claim.createdAt|date('d-m-Y') }}</td>

                {% set myClaimType = entity.claim.claimType == null ? '' : entity.claim.claimType.name %}
                <input type="hidden" name="tableArray[{{ claimID }}][claimType]" id="{{ claimID }}_claimType" value="{{ myClaimType }}" />
                <td>{{ myClaimType }}</td>

                <input type="hidden" name="tableArray[{{ claimID }}][claim]" id="{{ claimID }}_claim" value="{{ entity.claim.claim }}" />
                <td style="width: 100px" title="{{ entity.claim.claim }}">{{ entity.claim.claim|slice(0, 10)~"..." }}</td>

                <input type="hidden" name="tableArray[{{ claimID }}][status]" id="{{ claimID }}_status" value="{{ entity.claim.status }}" />
                <td>{{ entity.claim.status }}</td>

                <input type="hidden" name="tableArray[{{ claimID }}][code]" id="{{ claimID }}_code" value="{{ entity.code }}" />
                <td>{{ entity.code }}</td>

                {% set myReplacement = entity.claim.replacement == 0 ? "No" : "Si" %}
                <input type="hidden" name="tableArray[{{ claimID }}][replacement]" id="{{ claimID }}_replacement" value="{{ myReplacement }}" />
                <td>{{ myReplacement }}</td>

                {% set myProductPurchase = entity.claim.productPurchase == 0 ? "No" : "Si" %}
                <input type="hidden" name="tableArray[{{ claimID }}][productPurchase]" id="{{ claimID }}_productPurchase" value="{{ myProductPurchase }}" />
                <td>{{ myProductPurchase }}</td>

                {% set purchaseAmount = entity.claim.productPurchaseAmount|number_format(2, ".", "") %}
                <input type="hidden" name="tableArray[{{ claimID }}][purchaseAmount]" id="{{ claimID }}_purchaseAmount" value="{{ purchaseAmount }}" />
                <td>{{ purchaseAmount }}</td>

                <input type="hidden" name="tableArray[{{ claimID }}][observation]" id="{{ claimID }}_observation" value="{{ entity.claim.observation }}" />
                <td title="{{ entity.claim.observation }}">{{ entity.claim.observation|slice(0, 10)~"..." }}</td>

                {% if(user.role.name == "ADMINISTRADOR") %}
                    <td>
                        <a href="{{ path('backend_admin_claim_edit', {'id': entity.claim.id }) }}">
                            <div class="btn btn-sm btn-primary">
                                <span class="fa fa-search"></span>
                            </div>

                        </a>
                    </td>

                {% endif %}
            </tr>
        {% endfor %}
        </tbody>
    </table>

    </form>

        <script type="text/javascript" language="Javascript">

            function submitExcel(){

                $('#pizote_spinner').show();
                $("#toExcel").val(true);

                $("#filterForm").submit();
                $('#pizote_spinner').hide();
                //tableToArray();
            }

        $( document ).ready(function() {
            // Handler for .ready() called.
            $('#dt_basic').DataTable({
                "aaSorting": [[ 0, "asc" ]],
            });

        });


    </script>

{% endblock %}

